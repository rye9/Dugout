<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Blacksox Dugout — Single Game Builder (v1.0)</title>
  <link rel="stylesheet" href="mobile-polish.css" />
  <style>
    /* Small safety net if CSS file fails to load */
    :root { --gap-s:8px; --gap-m:16px; --gap-l:24px; --muted:#6b7280; --card:#0f172a; --ink:#e5e7eb; --ink-weak:#94a3b8; --accent:#22c55e; --line:#1f2937; }
    body { background:#0b1220; color:#e5e7eb; font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; }
  </style>
</head>
<body>
  <header class="page-header">
    <h1>Blacksox Dugout — Single Game Builder <span class="ver">v1.0</span></h1>
  </header>

  <main class="container">
    <!-- =================== ROSTER =================== -->
    <section id="roster" class="section">
      <h2>Roster</h2>

      <!-- Settings block: stacked controls -->
      <div class="roster-controls">
        <label class="field">
          <span>Filter</span>
          <select id="rosterFilter">
            <option value="all">All Players</option>
            <option value="pitchers">Pitchers</option>
            <option value="catchers">Catchers</option>
            <option value="infield">Infielders</option>
            <option value="outfield">Outfielders</option>
          </select>
        </label>

        <label class="field">
          <span>Sort</span>
          <select id="rosterSort">
            <option value="rank-asc">Rank (low → high)</option>
            <option value="name-asc">Name (A → Z)</option>
            <option value="name-desc">Name (Z → A)</option>
          </select>
        </label>

        <label class="field">
          <span>Availability</span>
          <select id="rosterAvail">
            <option value="all">All</option>
            <option value="available">Available</option>
            <option value="limited">Limited</option>
            <option value="out">Out</option>
          </select>
        </label>
      </div>

      <!-- Player cards grid -->
      <div id="rosterList" class="player-list"></div>
    </section>

    <!-- =================== GAME SETUP =================== -->
    <section id="game-setup" class="section">
      <h2>Game Setup</h2>

      <div class="setup-grid">
        <!-- Row: Starting Pitcher -->
        <div class="role-row">
          <div class="cell">
            <label>Starting Pitcher</label>
            <select id="spName"></select>
          </div>
          <div class="cell">
            <label>Innings</label>
            <input type="number" id="spInnings" min="0" max="6" value="2" />
          </div>
          <div class="cell">
            <label>Pitches</label>
            <input type="number" id="spPitches" min="0" max="85" value="0" />
          </div>
          <div class="cell">
            <div class="rest-day-group">
              <span id="spRest" class="pill good">OK</span>
            </div>
          </div>
        </div>

        <!-- Row: Relief Pitcher -->
        <div class="role-row">
          <div class="cell">
            <label>Relief Pitcher</label>
            <select id="rpName"></select>
          </div>
          <div class="cell">
            <label>Innings</label>
            <input type="number" id="rpInnings" min="0" max="6" value="2" />
          </div>
          <div class="cell">
            <label>Pitches</label>
            <input type="number" id="rpPitches" min="0" max="85" value="0" />
          </div>
          <div class="cell">
            <div class="rest-day-group">
              <span id="rpRest" class="pill">Check</span>
            </div>
          </div>
        </div>

        <!-- Row: Closer -->
        <div class="role-row">
          <div class="cell">
            <label>Closer</label>
            <select id="cpName"></select>
          </div>
          <div class="cell">
            <label>Innings</label>
            <input type="number" id="cpInnings" min="0" max="6" value="2" />
          </div>
          <div class="cell">
            <label>Pitches</label>
            <input type="number" id="cpPitches" min="0" max="85" value="0" />
          </div>
          <div class="cell">
            <div class="rest-day-group">
              <span id="cpRest" class="pill warn">Needs 1 day</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- =================== SIX-INNING ROTATION =================== -->
    <section id="six" class="section panel">
      <div class="section-header">
        <h2>Six-Inning Rotation</h2>
        <div class="actions">
          <!-- moved here from roster -->
          <button id="editRotation" class="btn">Edit Rotation</button>
        </div>
      </div>

      <div id="rotationGrid" class="rotation-grid">
        <!-- filled by JS -->
      </div>
    </section>

    <!-- =================== DEFENSIVE INNINGS TRACKER =================== -->
    <section id="min-innings" class="section">
      <h2>Defensive Innings Tracker</h2>

      <div id="inningsTracker" class="tracker">
        <!-- filled by JS -->
      </div>
    </section>
  </main>

  <footer class="page-footer">
    <small>© Blacksox Dugout</small>
  </footer>

  <!-- =================== SCRIPT =================== -->
  <script>
    /***** Demo data (replace with your data source if you already have one) *****/
    const players = [
      { id: 1,  name: "Alex Johnson",     rank: 1,  primary: "SS", secondary: "P",   avail: "available" },
      { id: 2,  name: "Mia Carter",       rank: 2,  primary: "C",  secondary: "3B",  avail: "available" },
      { id: 3,  name: "Noah Kim",         rank: 3,  primary: "CF", secondary: "SS",  avail: "available" },
      { id: 4,  name: "Olivia Nguyen",    rank: 4,  primary: "1B", secondary: "P",   avail: "limited"   },
      { id: 5,  name: "Ethan Rivera",     rank: 5,  primary: "RF", secondary: "2B",  avail: "available" },
      { id: 6,  name: "Harper Brooks",    rank: 6,  primary: "2B", secondary: "LF",  avail: "available" },
      { id: 7,  name: "Liam Patel",       rank: 7,  primary: "3B", secondary: "1B",  avail: "available" },
      { id: 8,  name: "Ava Thompson",     rank: 8,  primary: "LF", secondary: "CF",  avail: "available" },
      { id: 9,  name: "Jackson Lee",      rank: 9,  primary: "P",  secondary: "SS",  avail: "available" },
      { id: 10, name: "Emma Garcia",      rank: 10, primary: "C",  secondary: "RF",  avail: "available" },

      /* The two you asked to reconfigure */
      { id: 11, name: "Truman Baker",     rank: 15, primary: "3B", secondary: "RF",  avail: "available" }, // will be updated
      { id: 12, name: "Bridger Collins",  rank: 16, primary: "2B", secondary: "LF",  avail: "available" }, // will be updated
    ];

    /***** Helpers you asked for *****/
    function firstNameOnly(s) {
      if (!s) return s;
      const token = String(s).replace(/\s+/g, " ").trim().split(" ")[0];
      return token || s;
    }

    // Data updates: Truman rank 11 LF/2B, Bridger rank 12
    function applyDefaultRosterFixes(list) {
      const byFirst = who => list.find(p => (p.name || "").trim().toLowerCase().startsWith(who));
      const truman  = byFirst("truman");
      const bridger = byFirst("bridger");

      if (truman) { truman.rank = 11; truman.primary = "LF"; truman.secondary = "2B"; }
      if (bridger) { bridger.rank = 12; }

      // Remove last names in data so the whole UI stays first-name only
      list.forEach(p => p.name = firstNameOnly(p.name));

      // Keep list rank-sorted for roster order
      list.sort((a,b) => (a.rank ?? 999) - (b.rank ?? 999));
    }

    // Populate selects with player names
    function fillPlayerSelect(sel, list) {
      sel.innerHTML = "";
      list.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.id;
        opt.textContent = p.name; // first-name already
        sel.appendChild(opt);
      });
    }

    // Render roster cards
    function renderRoster(list) {
      const wrap = document.getElementById("rosterList");
      wrap.innerHTML = "";
      list.forEach(p => {
        const card = document.createElement("article");
        card.className = "player-card";

        const header = document.createElement("div");
        header.className = "player-card__header";
        const nm = document.createElement("div");
        nm.className = "player-name";
        nm.textContent = p.name; // first name only
        const meta = document.createElement("div");
        meta.className = "player-meta";
        meta.textContent = `#${p.rank} — ${p.primary} • ${p.secondary}`;
        header.append(nm, meta);

        const fields = document.createElement("div");
        fields.className = "player-card__fields";
        fields.innerHTML = `
          <div class="field"><span>Primary</span><div>${p.primary}</div></div>
          <div class="field"><span>Secondary</span><div>${p.secondary}</div></div>
          <div class="field"><span>Availability</span><div>${p.avail}</div></div>
          <div class="field"><span>Rank</span><div>${p.rank}</div></div>
        `;

        card.append(header, fields);
        wrap.appendChild(card);
      });
    }

    // Render rotation grid (simple 6 innings x 9 positions mock)
    function renderRotation(list) {
      const grid = document.getElementById("rotationGrid");
      grid.innerHTML = "";
      const positions = ["P","C","1B","2B","3B","SS","LF","CF","RF"];
      for (let inning = 1; inning <= 6; inning++) {
        const row = document.createElement("div");
        row.className = "rot-row";
        const tag = document.createElement("div");
        tag.className = "rot-inning";
        tag.textContent = `Inning ${inning}`;
        row.appendChild(tag);
        positions.forEach((pos, i) => {
          const cell = document.createElement("div");
          cell.className = "rot-cell";
          const p = list[(inning - 1 + i) % list.length];
          cell.innerHTML = `<div class="rot-pos">${pos}</div><div class="rot-name">${p ? p.name : ""}</div>`;
          row.appendChild(cell);
        });
        grid.appendChild(row);
      }
    }

    // Render Defensive Innings Tracker (no rank chips shown here)
    function renderInningsTracker(list) {
      const t = document.getElementById("inningsTracker");
      t.innerHTML = "";
      list.forEach(p => {
        const row = document.createElement("div");
        row.className = "track-row";
        row.innerHTML = `
          <div class="badge">
            <span class="track-name">${p.name}</span>
            <!-- rank intentionally omitted in this section -->
          </div>
          <div class="bar">
            <div class="bar-fill" style="width:${Math.min(100, (Math.random()*100)).toFixed(0)}%"></div>
          </div>
        `;
        t.appendChild(row);
      });
    }

    // Rest-day indicator demo (you likely have your own logic)
    function recalcRestPills() {
      const val = parseInt(document.getElementById("spPitches").value || "0", 10);
      const pill = document.getElementById("spRest");
      if (val >= 65) {
        pill.className = "pill bad";
        pill.textContent = "Needs 3 days";
      } else if (val >= 40) {
        pill.className = "pill warn";
        pill.textContent = "Needs 2 days";
      } else if (val >= 21) {
        pill.className = "pill warn";
        pill.textContent = "Needs 1 day";
      } else {
        pill.className = "pill good";
        pill.textContent = "OK";
      }
    }

    // Wire up filter/sort (basic example)
    function applyRosterControls() {
      const filter = document.getElementById("rosterFilter").value;
      const sort   = document.getElementById("rosterSort").value;
      const avail  = document.getElementById("rosterAvail").value;

      let filtered = players.slice();

      if (avail !== "all") filtered = filtered.filter(p => p.avail === avail);

      if (filter === "pitchers") filtered = filtered.filter(p => p.primary === "P" || p.secondary === "P");
      if (filter === "catchers") filtered = filtered.filter(p => p.primary === "C" || p.secondary === "C");
      if (filter === "infield")  filtered = filtered.filter(p => ["1B","2B","3B","SS"].includes(p.primary) || ["1B","2B","3B","SS"].includes(p.secondary));
      if (filter === "outfield") filtered = filtered.filter(p => ["LF","CF","RF"].includes(p.primary) || ["LF","CF","RF"].includes(p.secondary));

      if (sort === "name-asc")  filtered.sort((a,b) => a.name.localeCompare(b.name));
      if (sort === "name-desc") filtered.sort((a,b) => b.name.localeCompare(a.name));
      if (sort === "rank-asc")  filtered.sort((a,b) => a.rank - b.rank);

      renderRoster(filtered);
    }

    // Initialize page
    (function init() {
      applyDefaultRosterFixes(players);

      // Fill selects with first-name-only values
      fillPlayerSelect(document.getElementById("spName"), players);
      fillPlayerSelect(document.getElementById("rpName"), players);
      fillPlayerSelect(document.getElementById("cpName"), players);

      // Initial renders
      applyRosterControls();
      renderRotation(players);
      renderInningsTracker(players);

      // Controls
      document.getElementById("rosterFilter").addEventListener("change", applyRosterControls);
      document.getElementById("rosterSort").addEventListener("change", applyRosterControls);
      document.getElementById("rosterAvail").addEventListener("change", applyRosterControls);

      ["spPitches","spInnings"].forEach(id => document.getElementById(id).addEventListener("input", recalcRestPills));

      // Defensive Innings Tracker: ensure any stray rank nodes are hidden if someone injects them later
      const section = document.querySelector("#min-innings");
      section.querySelectorAll(".rank, .player-rank, [data-rank]").forEach(n => n.remove());
    })();
  </script>
</body>
</html>
